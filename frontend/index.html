<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Route map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
<h1 class="titulo-principal">Un mismo camino, muchas rutas</h1>  
<link rel="stylesheet" href="style.css" />

<style>
      #loginModal {
      position: fixed;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      display: none;
      z-index: 1000;
    }
    #overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      z-index: 999;
    }

 * {
      box-sizing: border-box;
    }
    
 html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
    }

   <button id="abrirLogin" style="
  position: absolute;
  top: 10px;
  right: 20px;
  z-index: 1001;
  padding: 8px 15px;
  background-color: #007BFF;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;


 /* Contenedor principal horizontal */
    .contenedor {
      display: flex;
      flex-direction: row;
      height: 100vh;
      width: 100vw;
    }

 /* Panel lateral de filtros */
    .filtros {
      width: 300px;
      background-color: #f9f9f9;
      padding: 20px;
      border-right: 1px solid #ddd;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
      .filtros h2 {
      margin-top: 0;
}

.filtros select {
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #bbb;
    }
 /* Contenedor del mapa */
    .mapa {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #eaeaea;
    }
    #route_map{
      height: 600px;
      width: 1000px;
    }



</style>

</head>

<body>

<!-- 🌍 Estructura: los selects y el mapa -->

 <div class="contenedor">

  <div id="overlay"></div>
  <div id="loginModal">
    <h2>Iniciar sesión</h2>
    <input type="email" id="correo" placeholder="Correo" /><br /><br />
    <input type="password" id="contraseña" placeholder="Contraseña" /><br /><br />
    <button onclick="login()">Ingresar</button>
    <p id="mensaje"></p>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="./src/script.js"></script>

  <!-- Panel lateral de filtros -->

   <aside class="filtros">
      <h2>Filtrar ubicación</h2>
      <label for="pais">País</label>
      <select id="pais">
        <option value="">Selecciona un país</option>
      </select>

      <label for="departamento">Departamento</label>
      <select id="departamento">
        <option value="">Selecciona un departamento</option>
      </select>

      <label for="ciudad">Ciudad</label>
      <select id="ciudad">
        <option value="">Selecciona una ciudad</option>
      </select>

      <button id="buscarUbicacion">Buscar ubicación</button>
    </aside>

    <!-- Mapa -->
    <main class="route_map">
      <div id="route_map"></div>
    </main>
 </div>
 <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
 const paisSelect = document.getElementById("pais");
 const deptSelect = document.getElementById("departamento");
 const ciudadSelect = document.getElementById("ciudad");
 const botonBuscar = document.getElementById("buscarUbicacion");
 let map = L.map('route_map').setView([4.6477, -74.0842], 12);
     L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

  L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Marcadores y ruta
    L.marker([4.68779, -74.16166]).addTo(map).bindPopup("Point 1").openPopup();
    L.marker([4.60417, -74.09042]).addTo(map).bindPopup("Point 2");
    L.marker([4.61648, -74.11952]).addTo(map).bindPopup("Point 3");

    const ruta = [
      [4.68779, -74.16166],
      [4.60417, -74.09042],
      [4.61648, -74.11952]
    ];

    L.polyline(ruta, {
      color: 'blue',
      weight: 4,
      opacity: 0.7,
      smoothFactor: 1
    }).addTo(map); 
    
    let data = [];

    fetch("data_world.json")
      .then(res => res.json())
      .then(json => {
        data = json;
        paisSelect.innerHTML = '<option value="">Selecciona un país</option>';
        data.forEach(pais => {
          const option = document.createElement("option");
          option.value = pais.id;
          option.textContent = pais.name;
          paisSelect.appendChild(option);
        });
      });


      
    paisSelect.addEventListener("change", () => {
      const paisId = parseInt(paisSelect.value);
      const pais = data.find(p => p.id === paisId);
       
      deptSelect.innerHTML = '<option value="">Selecciona un departamento</option>';
      // Detectar y traducir el tipo de división territorial
if (pais && pais.states && pais.states.length > 0) {
  const tipo = pais.states[0].type?.toLowerCase();
  const traducciones = {
    department: "Departamento",
    province: "Provincia",
    state: "Estado",
    region: "Región",
    territory: "Territorio",
    district: "Distrito"
  };
  const nombreEscala = traducciones[tipo] || "División";
  document.querySelector("label[for='departamento']").textContent = nombreEscala;
}
      
      
      ciudadSelect.innerHTML = '<option value="">Selecciona una ciudad</option>';

      if (pais && pais.states) {
        pais.states.forEach(dept => {
          const option = document.createElement("option");
          option.value = dept.id;
          option.textContent = dept.name;
          deptSelect.appendChild(option);
        });
      }
    });

    deptSelect.addEventListener("change", () => {
      const paisId = parseInt(paisSelect.value);
      const deptId = parseInt(deptSelect.value);
      const pais = data.find(p => p.id === paisId);
      const estado = pais.states.find(s => s.id === deptId);

      ciudadSelect.innerHTML = '<option value="">Selecciona una ciudad</option>';

      if (estado && estado.cities) {
        estado.cities.forEach(ciudad => {
          const option = document.createElement("option");
          option.value = ciudad.id;
          option.textContent = ciudad.name;
          ciudadSelect.appendChild(option);
        });
      }
    });

     botonBuscar.addEventListener("click", () => {
      const paisId = parseInt(paisSelect.value);
      const deptId = parseInt(deptSelect.value);
      const ciudadId = parseInt(ciudadSelect.value);

      const pais = data.find(p => p.id === paisId);
      if (!pais || !pais.states) return;

      let ciudad = null;
if (pais.states && deptId && ciudadId) {
        const dept = pais.states.find(d => d.id === deptId);
        if (dept && dept.cities) {
          ciudad = dept.cities.find(c => c.id === ciudadId);
        }
      } else if (pais.states) {
        for (const dept of pais.states) {
          if (dept.cities) {
            const encontrada = dept.cities.find(c => c.id === ciudadId);
            if (encontrada) {
              ciudad = encontrada;
              break;
            }
          }
        }
      }

      if (!ciudad) {
        alert("No se encontró la ciudad o faltan datos.");
        return;
      }

      const lat = parseFloat(ciudad.latitude);
      const lon = parseFloat(ciudad.longitude);

      if (!isNaN(lat) && !isNaN(lon)) {
        map.setView([lat, lon], 13);
        L.popup()
          .setLatLng([lat, lon])
          .setContent(`<b>${ciudad.name}</b>`)
          .openOn(map);
      } else {
        alert("La ciudad seleccionada no tiene coordenadas válidas.");
      }
    });

</script>
  
<div id="route_map"></div>


<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<script>

let map=L.map('route_map').setView([4.6477, -74.0842],12)

L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

L.marker([4.68779, -74.16166]).addTo(map).bindPopup("Point 1").openPopup()
L.marker([4.60417, -74.09042]).addTo(map).bindPopup("Point 2");
L.marker([4.61648, -74.11952]).addTo(map).bindPopup("Point 3");

// Coordenadas de la ruta (puedes cambiarlas)
const ruta =[
  [4.68779, -74.16166],   // Punto A
  [4.60417, -74.09042],   // Punto B
  [4.61648, -74.11952]    // Punto C
];


// Agrega la polilínea al mapa
L.polyline(ruta, {
  color: 'blue',
  weight: 4,
  opacity: 0.7,
  smoothFactor: 1
}).addTo(map);

</script>

 
  </script>

  <!-- Aquí puedes poner también el script de Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    let map = L.map('route_map').setView([4.65, -74.1], 10);

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);
  
    <script>
  // Aquí tu código JavaScript
fetch("data_world.json")
  .then(res => res.json())
  .then(paises => {
    const paisSelect = document.getElementById("pais");
    paises.forEach(pais => {
      const option = document.createElement("option");
      option.value = pais.id;
      option.textContent = pais.name;
      paisSelect.appendChild(option);
    });
  })
  .catch(error => {
    console.error("Error al cargar data_world.json:", error);
  });
</script>

<footer class="footer">
  <p>© 2025 Laura Vargas | Proyecto nort3d.tech</p>
</footer>

<!-- Botón en la esquina superior derecha -->
<button id="abrirLogin" style="
  position: absolute;
  top: 10px;
  right: 20px;
  z-index: 1001;
  padding: 8px 15px;
  background-color: #007BFF;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
">
  Iniciar sesión
</button>

<!-- Modal de login -->
<div id="overlay"></div>
<div id="loginModal" style="display:none; position: fixed; top: 30%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.3); z-index: 1000;">
  <h2>Iniciar sesión</h2>
  <input type="email" id="correo" placeholder="Correo" /><br /><br />
  <input type="password" id="contraseña" placeholder="Contraseña" /><br /><br />
  <button onclick="login()">Ingresar</button>
  <p id="mensaje"></p>
  <p>¿No tienes cuenta? <a href="#" id="mostrarRegistro">Regístrate</a></p>
</div>

<script>
  // Mostrar modal al hacer clic en el botón
  document.getElementById("abrirLogin").addEventListener("click", () => {
    document.getElementById("overlay").style.display = "block";
    document.getElementById("loginModal").style.display = "block";
  });

  function login() {
    const correo = document.getElementById("correo").value;
    const contraseña = document.getElementById("contraseña").value;

    fetch("http://localhost:5000/api/auth/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ correo, contraseña }),
    })
    .then(res => res.json())
    .then(data => {
      if (data.token) {
        document.getElementById("mensaje").textContent = "✔️ Login exitoso";
        document.getElementById("loginModal").style.display = "none";
        document.getElementById("overlay").style.display = "none";
        localStorage.setItem("token", data.token);
      } else {
        document.getElementById("mensaje").textContent = "❌ " + data.mensaje;
      }
    })
    .catch(err => {
      console.error("Error:", err);
      document.getElementById("mensaje").textContent = "❌ Error de conexión";
    });
  }

  // (Este esqueleto sirve para enlazar el modal de registro si lo haces luego)
  document.getElementById("mostrarRegistro").addEventListener("click", (e) => {
    e.preventDefault();
    alert("Aquí se abriría el formulario de registro"); // Aquí luego puedes mostrar otro modal
  });
</script>
<script>
  fetch("data_world.json")
  .then(res => res.json())
  .then(json => {
    data = json;
    paisSelect.innerHTML = '<option value="">Selecciona un país</option>';
    data.forEach(pais => {
      const option = document.createElement("option");
      option.value = pais.id;
      option.textContent = pais.name;
      paisSelect.appendChild(option);
    });
  })
  .catch(error => {
    console.error("Error al cargar data_world.json:", error);
  });

  
  
  </script>

</body>
</html>